<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cold War Origins: Mastery Quest</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');

        body { 
            margin: 0; 
            background: #0a0a0a; 
            font-family: 'Inter', sans-serif; 
            overflow: hidden; 
            color: white; 
        }

        #game-container {
            position: relative; 
            width: 100vw; 
            height: 100vh; 
            background: linear-gradient(to bottom, #1e3a8a, #3b82f6);
            overflow: hidden;
        }

        canvas { display: block; }

        #start-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); display: flex; flex-direction: column;
            justify-content: center; align-items: center; z-index: 200;
        }

        #btn-start {
            padding: 20px 40px; font-size: 24px; font-weight: 900; color: #000;
            background: #facc15; border: none; border-radius: 12px; cursor: pointer; 
            transition: all 0.2s; text-transform: uppercase;
        }

        #btn-start:hover { transform: scale(1.1); background: #fff; box-shadow: 0 0 30px #facc15; }

        #ui-layer { 
            position: absolute; top: 20px; left: 30px; right: 30px; 
            pointer-events: none; display: flex; justify-content: space-between; 
            font-weight: 900; text-shadow: 2px 2px #000; font-size: 24px; z-index: 10; 
        }

        #stats-coins { color: #facc15; }

        #quiz-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(2, 6, 23, 0.98); display: none; flex-direction: column;
            justify-content: center; align-items: center; text-align: center; padding: 40px; z-index: 100;
        }

        .option-btn { 
            background: #1e293b; color: #fff; border: 2px solid #334155; 
            padding: 15px; margin: 8px; cursor: pointer; width: 100%; max-width: 600px; 
            border-radius: 8px; font-size: 18px; font-weight: bold; transition: 0.2s;
            text-align: left;
        }

        .option-btn:hover { background: #3b82f6; border-color: #60a5fa; transform: translateX(10px); }

        #message { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); 
            font-size: 80px; display: none; text-align: center; 
            text-shadow: 6px 6px 0px #000; z-index: 110; font-weight: 900; color: #ef4444; width: 100%; 
        }

        .feedback-text {
            font-size: 24px;
            font-weight: 900;
            margin-top: 20px;
            text-transform: uppercase;
            font-style: italic;
        }
    </style>
</head>
<body>

<div id="game-container">
    <div id="start-screen">
        <h1 style="color: #facc15; font-size: 48px; margin-bottom: 10px;">COLD WAR MASTERY</h1>
        <p style="margin-bottom: 30px; font-weight: bold; color: #94a3b8;">JUMP TO HIT BRICKS. CORRECT REMOVES. WRONG REPEATS.</p>
        <button id="btn-start">INITIALIZE MISSION</button>
    </div>

    <div id="ui-layer">
        <div id="stats-lives" style="color:#ef4444">HP: ❤️❤️❤️</div>
        <div id="stats-coins">INTEL: 0</div>
        <div id="stats-timer">120s</div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <div id="quiz-overlay">
        <div style="color: #3b82f6; font-size: 14px; font-weight: 900; letter-spacing: 0.2em; margin-bottom: 10px;">DECRYPTION REQUIRED</div>
        <div id="question-text" style="color: #fff; font-size: 28px; font-weight: 900; margin-bottom: 30px; max-width: 800px; line-height: 1.2;"></div>
        <div id="options-container" style="width:100%; display: flex; flex-direction: column; align-items: center;"></div>
        <div id="quiz-feedback" class="feedback-text"></div>
    </div>

    <div id="message"></div>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

let gameStarted = false, gameActive = false, isFalling = false;
let timer = 120, lives = 3, coins = 0;
const gravity = 0.5;

const player = { x: 100, y: 200, w: 40, h: 65, vx: 0, vy: 0, speed: 6, jumpPower: -12, grounded: false, facingRight: true };

// SHUFFLE FUNCTION
function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}

/* ===== COLD WAR MCQ DECK - OPTION LENGTH BALANCED ===== */
const masterDeck = [
    { q: "What were the code names for the two atomic bombs used against Japan?", a: ["Trinity and Mike", "Little Boy and Fat Man", "Olympic and Coronet", "Silver and Copper"], correct: "Little Boy and Fat Man" },
    { q: "Which city was the primary target of the first atomic mission on 6 August 1945?", a: ["Nagasaki", "Kokura", "Hiroshima", "Kyoto"], correct: "Hiroshima" },
    { q: "What was the name of the first nuclear test explosion in July 1945?", a: ["Centerboard", "Trinity", "Manhattan", "Overlord"], correct: "Trinity" },
    { q: "Why did Henry Stimson insist on removing Kyoto from the target list?", a: ["Lacked any military value", "Great cultural significance", "Target was firebombed already", "Planned for Allied HQ use"], correct: "Great cultural significance" },
    { q: "Stalin requested a Second Front primarily to:", a: ["Invasion of Britain", "Force a two-front war", "Seize nuclear technology", "End the Nazi-Soviet Pact"], correct: "Force a two-front war" },
    { q: "The Truman Doctrine (1947) responded to a power vacuum left by:", a: ["Germany", "Great Britain", "France", "Japan"], correct: "Great Britain" },
    { q: "George Kennan's 'Long Telegram' proposed what strategy?", a: ["Appeasement", "Containment", "Isolationism", "Rollback"], correct: "Containment" },
    { q: "The Truman Doctrine primarily supported which two nations initially?", a: ["France and Italy", "Greece and Turkey", "Germany and Poland", "China and Japan"], correct: "Greece and Turkey" },
    { q: "Stalin attacked the Marshall Plan as:", a: ["Capitalist Charity", "Dollar Imperialism", "Economic Expansion", "Western Propaganda"], correct: "Dollar Imperialism" },
    { q: "What was the immediate trigger for the Berlin Blockade?", a: ["NATO was formed", "New Deutsche Mark", "The Korean War", "Iron Curtain Speech"], correct: "New Deutsche Mark" },
    { q: "What was the US code name for the Berlin Airlift?", a: ["Operation Downfall", "Operation Vittles", "Operation Silver", "Operation Overlord"], correct: "Operation Vittles" },
    { q: "What core concept does NATO's Article 5 represent?", a: ["Shared economic aid", "Collective defense pact", "Banning nuclear arms", "Creation of trade unions"], correct: "Collective defense pact" }
];

let questionsDeck = shuffle([...masterDeck]);

// STAGGERED BLOCKS
const blocks = Array.from({length: 40}, (_, i) => ({ 
    x: 500 + (i * 350), 
    y: 120 + (Math.random() * 100), 
    w: 60, 
    h: 60, 
    active: true 
}));

function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

document.getElementById('btn-start').onclick = () => {
    document.getElementById('start-screen').style.display = 'none';
    gameStarted = true; gameActive = true;
};

const keys = {};
window.onkeydown = e => keys[e.code] = true;
window.onkeyup = e => keys[e.code] = false;

function drawPlayer() {
    ctx.save();
    ctx.translate(player.x + player.w / 2, player.y + player.h / 2);
    if (!player.facingRight) ctx.scale(-1, 1);
    ctx.fillStyle = "#ffdbac"; ctx.fillRect(-15, -30, 30, 25);
    ctx.fillStyle = "white"; ctx.fillRect(-10, -22, 8, 10); ctx.fillRect(2, -22, 8, 10);
    ctx.fillStyle = "black"; ctx.fillRect(-7, -19, 4, 5); ctx.fillRect(5, -19, 4, 5);
    ctx.fillStyle = "white"; ctx.fillRect(-16, -5, 32, 22);
    ctx.fillStyle = "#1d4ed8"; ctx.fillRect(-16, 17, 32, 13);
    ctx.fillStyle = "#ffdbac"; ctx.fillRect(-12, 30, 8, 5); ctx.fillRect(4, 30, 8, 5);
    ctx.restore();
}

function triggerQuiz() {
    gameActive = false;
    const currentQ = questionsDeck[0];
    const overlay = document.getElementById('quiz-overlay');
    const qText = document.getElementById('question-text');
    const feedback = document.getElementById('quiz-feedback');
    const container = document.getElementById('options-container');

    qText.innerText = currentQ.q;
    feedback.innerText = "";
    container.innerHTML = '';

    // Shuffle the options before displaying them
    let opts = shuffle([...currentQ.a]);

    opts.forEach(opt => {
        const btn = document.createElement('button');
        btn.className = 'option-btn'; 
        btn.innerText = opt;
        btn.onclick = () => {
            const btns = container.querySelectorAll('button');
            btns.forEach(b => b.disabled = true);

            if (opt === currentQ.correct) {
                coins += 10;
                document.getElementById('stats-coins').innerText = `INTEL: ${coins}`;
                feedback.innerText = "CORRECT! INTEL SECURED.";
                feedback.style.color = "#22c55e";
                
                setTimeout(() => {
                    overlay.style.display = 'none';
                    questionsDeck.shift(); // Remove correct answer
                    gameActive = (timer > 0);
                }, 1200);
            } else {
                feedback.innerText = "WRONG! CORRECT ANSWER: " + currentQ.correct;
                feedback.style.color = "#ef4444";
                
                setTimeout(() => {
                    overlay.style.display = 'none';
                    isFalling = true; // Punishment fall
                    const missed = questionsDeck.shift();
                    questionsDeck.push(missed); // Move to end of deck
                }, 2500);
            }
        };
        container.appendChild(btn);
    });

    overlay.style.display = 'flex';
}

function updateHUD() {
    document.getElementById('stats-lives').innerText = `HP: ${'❤️'.repeat(lives)}`;
}

function update() {
    if (!gameStarted) { requestAnimationFrame(update); return; }

    if (timer <= 0 && gameActive) {
        gameActive = false;
        document.getElementById('message').style.display = 'block';
        document.getElementById('message').innerText = "TIME EXPIRED";
    }

    if (isFalling) {
        player.vy += gravity; player.y += player.vy;
        if (player.y > canvas.height + 100) {
            lives--; 
            updateHUD();
            if (lives <= 0) {
                gameActive = false;
                document.getElementById('message').style.display = 'block';
                document.getElementById('message').innerText = "MISSION FAILED";
            } else {
                player.x = Math.max(0, player.x - 400); 
                player.y = -100; 
                player.vy = 0; 
                isFalling = false;
                if (timer > 0) gameActive = true;
            }
        }
    } else if (gameActive) {
        if (keys['ArrowRight']) { player.vx = player.speed; player.facingRight = true; }
        else if (keys['ArrowLeft']) { player.vx = -player.speed; player.facingRight = false; }
        else player.vx *= 0.8;

        if (keys['Space'] && player.grounded) { player.vy = player.jumpPower; player.grounded = false; }

        player.vy += gravity; player.x += player.vx; player.y += player.vy;

        const groundY = canvas.height - 80;
        if (player.y + player.h > groundY) { 
            player.y = groundY - player.h; 
            player.vy = 0; 
            player.grounded = true; 
        }

        blocks.forEach((b) => {
            if (b.active && player.x < b.x + b.w && player.x + player.w > b.x && player.y < b.y + b.h && player.y + player.h > b.y) {
                if (player.vy < 0 && (player.y + player.h / 2) > (b.y + b.h / 2)) {
                    b.active = false; 
                    player.vy = 4;
                    if (questionsDeck.length > 0) triggerQuiz();
                    else {
                        gameActive = false;
                        document.getElementById('message').style.display = 'block';
                        document.getElementById('message').innerText = "MISSION COMPLETE!";
                    }
                }
            }
        });
    }

    ctx.setTransform(1,0,0,1,0,0); 
    ctx.clearRect(0,0,canvas.width,canvas.height);
    
    let camX = -player.x + canvas.width / 4; 
    if (camX > 0) camX = 0;
    ctx.translate(camX, 0);

    ctx.fillStyle = isFalling ? '#1e1b4b' : '#0f172a'; 
    ctx.fillRect(-2000, canvas.height - 80, 20000, 80);

    blocks.forEach(b => {
        if (b.active) {
            ctx.fillStyle = '#fbbf24'; 
            ctx.fillRect(b.x, b.y, b.w, b.h);
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 3;
            ctx.strokeRect(b.x, b.y, b.w, b.h);
            ctx.fillStyle = 'black'; 
            ctx.font = 'bold 30px Inter'; 
            ctx.textAlign = 'center';
            ctx.fillText('?', b.x + b.w/2, b.y + b.h/2 + 10);
        }
    });

    drawPlayer();
    requestAnimationFrame(update);
}

setInterval(() => {
    if (gameActive && timer > 0) {
        timer--;
        document.getElementById('stats-timer').innerText = timer + "s";
    }
}, 1000);

update();
</script>
</body>
</html>
