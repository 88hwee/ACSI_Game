<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>History Mastery: Rise of Hitler</title>
    <style>
        body { margin: 0; background: #0f172a; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; overflow: hidden; color: white; }
        
        #game-container { 
            position: relative; width: 100vw; height: 100vh; 
            max-width: 1000px; max-height: 500px; 
            margin: 20px auto; 
            background: linear-gradient(to bottom, #1e293b, #334155); 
            border: 4px solid #475569; border-radius: 12px; overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }

        canvas { display: block; background: skyblue; }

        #start-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15, 23, 42, 0.95); display: flex; flex-direction: column;
            justify-content: center; align-items: center; z-index: 200; text-align: center;
        }

        #btn-start {
            padding: 18px 40px; font-size: 24px; font-weight: 800; color: #1e293b;
            background: #fbbf24; border: none; border-radius: 50px; cursor: pointer; 
            transition: all 0.2s; box-shadow: 0 4px 0 #b45309;
        }
        #btn-start:hover { transform: translateY(-2px); background: #fcd34d; box-shadow: 0 6px 0 #b45309; }
        #btn-start:active { transform: translateY(2px); box-shadow: 0 0 0 #b45309; }

        #ui-layer { 
            position: absolute; top: 15px; left: 20px; right: 20px; 
            pointer-events: none; display: flex; justify-content: space-between; 
            font-weight: bold; font-size: 20px; z-index: 10; 
        }
        .stat-box { background: rgba(0,0,0,0.4); padding: 5px 15px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.2); }
        #stats-coins { color: #fbbf24; }
        #stats-lives { color: #ef4444; }

        #quiz-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15, 23, 42, 0.98); display: none; flex-direction: column;
            justify-content: center; align-items: center; text-align: center; padding: 30px; z-index: 100;
        }

        #question-text { color: #fbbf24; font-size: 22px; margin-bottom: 20px; max-width: 80%; line-height: 1.4; }
        
        .option-btn { 
            background: #334155; color: white; border: 2px solid #475569; 
            padding: 15px; margin: 8px; cursor: pointer; width: 90%; max-width: 500px; 
            border-radius: 12px; font-size: 18px; font-weight: 600; transition: all 0.2s;
        }
        .option-btn:hover { background: #475569; transform: scale(1.02); }
        .option-btn.correct { background: #22c55e !important; border-color: #166534; }
        .option-btn.wrong { background: #ef4444 !important; border-color: #991b1b; }

        #feedback-area { margin-top: 15px; font-size: 20px; font-weight: bold; min-height: 30px; }

        #message { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); 
            font-size: 72px; display: none; text-align: center; 
            z-index: 110; font-weight: 900; color: #ef4444; width: 100%; text-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }

        .hint { margin-top: 20px; font-size: 14px; opacity: 0.7; color: #94a3b8; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="start-screen">
        <h1 style="color: #fbbf24; font-size: 42px; margin-bottom: 10px;">Rise of Hitler: Quest</h1>
        <p style="font-size: 18px; margin-bottom: 30px;">Jump into blocks to answer questions.<br>Double tap <b>SPACE</b> to jump higher!</p>
        <button id="btn-start">ENTER HISTORY</button>
        <div class="hint">Goal: Answer all questions to achieve Mastery.</div>
    </div>
    
    <div id="ui-layer">
        <div class="stat-box" id="stats-lives">Lives: 3</div>
        <div class="stat-box" id="stats-coins">Score: 0</div>
        <div class="stat-box" id="stats-timer">Time: 120s</div>
    </div>

    <canvas id="gameCanvas" width="1000" height="500"></canvas>
    
    <div id="quiz-overlay">
        <div id="question-text"></div>
        <div id="options-container" style="width:100%; display: flex; flex-direction: column; align-items: center;"></div>
        <div id="feedback-area"></div>
    </div>
    
    <div id="message"></div>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

// Placeholder for sound (will fail gracefully if not found)
const failSound = new Audio('https://assets.mixkit.co/active_storage/sfx/2042/2042-preview.mp3');

let gameStarted = false, gameActive = false, isFalling = false, isPaused = false;
let timer = 120, lives = 3, coins = 0, streak = 0;
const gravity = 0.5;

const player = { 
    x: 100, y: 300, w: 40, h: 60, 
    vx: 0, vy: 0, 
    speed: 6, jumpPower: -11, 
    grounded: false, facingRight: true,
    jumpsAvailable: 2 // For double jump logic
};

let questionsDeck = [
    { q: "The Weimar Republic was created after:", a: ["1871 unification", "Germany’s defeat in WWI", "The Great Depression ended", "Hitler became Chancellor"], correct: "Germany’s defeat in WWI" },
    { q: "A key problem of proportional representation was that it:", a: ["Guaranteed one-party rule", "Produced many parties and unstable coalitions", "Banned extremist parties", "Removed elections"], correct: "Produced many parties and unstable coalitions" },
    { q: "The Treaty of Versailles caused anger mainly because Germans felt it was:", a: ["Too generous", "A “diktat” imposed without negotiation", "Written by Germany", "Secretly beneficial"], correct: "A “diktat” imposed without negotiation" },
    { q: "The “war guilt clause” is also known as:", a: ["Article 48", "Article 231", "Enabling Act", "Dawes Plan"], correct: "Article 231" },
    { q: "Reparations were:", a: ["Rewards Germany received", "Payments Germany had to make to the Allies", "A Nazi youth programme", "A type of election"], correct: "Payments Germany had to make to the Allies" },
    { q: "Hyperinflation in 1923 was triggered largely by:", a: ["Too much gold", "Printing money to pay debts and the Ruhr crisis", "Winning WWI", "Low unemployment"], correct: "Printing money to pay debts and the Ruhr crisis" },
    { q: "During hyperinflation, people with savings were generally:", a: ["Protected", "Ruined as money lost value", "Richer overnight", "Unaffected"], correct: "Ruined as money lost value" },
    { q: "The Ruhr crisis involved:", a: ["France/Belgium occupying an industrial region", "Germany occupying Poland", "Britain invading Berlin", "The USA closing banks"], correct: "France/Belgium occupying an industrial region" },
    { q: "Stresemann is linked to:", a: ["Ending democracy", "Stabilising the currency and improving foreign relations", "Starting the SA", "Writing Mein Kampf"], correct: "Stabilising the currency and improving foreign relations" },
    { q: "The Dawes Plan (1924) mainly:", a: ["Increased reparations sharply", "Reorganised reparations and relied on US loans", "Created the Gestapo", "Ended elections"], correct: "Reorganised reparations and relied on US loans" },
    { q: "The Great Depression began after:", a: ["Wall Street Crash (1929)", "Versailles (1919)", "Ruhr occupation (1923)", "Enabling Act (1933)"], correct: "Wall Street Crash (1929)" },
    { q: "The Nazi Party is also called:", a: ["SPD", "NSDAP", "KPD", "DNVP"], correct: "NSDAP" },
    { q: "Hitler’s book was:", a: ["Das Kapital", "Mein Kampf", "The Communist Manifesto", "The Prince"], correct: "Mein Kampf" },
    { q: "The Beer Hall Putsch (1923) was:", a: ["A successful revolution", "A failed Nazi coup attempt in Munich", "A German election", "A treaty"], correct: "A failed Nazi coup attempt in Munich" },
    { q: "Nazi propaganda was led by:", a: ["Goebbels", "Stalin", "Churchill", "Trotsky"], correct: "Goebbels" },
    { q: "The SA were:", a: ["Secret police", "Nazi stormtroopers who used intimidation", "German judges", "Church leaders"], correct: "Nazi stormtroopers who used intimidation" },
    { q: "Hitler became Chancellor on:", a: ["30 Jan 1933", "1 Sep 1939", "11 Nov 1918", "28 Jun 1919"], correct: "30 Jan 1933" },
    { q: "The Reichstag Fire happened in:", a: ["1923", "1933", "1936", "1941"], correct: "1933" },
    { q: "The Enabling Act (March 1933) allowed Hitler to:", a: ["Rule by decree without parliament", "Leave Germany", "Abolish the presidency immediately", "Create the League of Nations"], correct: "Rule by decree without parliament" },
    { q: "The “Night of the Long Knives” (1934) was:", a: ["A peace treaty", "A purge to remove SA leaders and rivals", "A communist uprising", "The Reichstag election"], correct: "A purge to remove SA leaders and rivals" }
];

function shuffle(arr) { 
    for (let i = arr.length - 1; i > 0; i--) { 
        const j = Math.floor(Math.random() * (i + 1)); 
        [arr[i], arr[j]] = [arr[j], arr[i]]; 
    } 
    return arr;
}

// Initial shuffle of questions
shuffle(questionsDeck);

// Blocks at different heights
const blocks = Array.from({length: 40}, (_, i) => ({ 
    x: 500 + (i * 350), 
    y: 120 + Math.floor(Math.random() * 150), // Random heights between 120 and 270
    w: 60, 
    h: 60, 
    active: true 
}));

document.getElementById('btn-start').onclick = () => {
    document.getElementById('start-screen').style.display = 'none';
    gameStarted = true; gameActive = true;
    // Pre-unlock audio
    failSound.play().then(() => { failSound.pause(); failSound.currentTime = 0; }).catch(() => {});
};

const keys = {};
window.onkeydown = e => {
    if (e.code === 'Space' && gameActive && !isPaused) {
        if (player.jumpsAvailable > 0) {
            player.vy = player.jumpPower;
            player.jumpsAvailable--;
            player.grounded = false;
        }
    }
    keys[e.code] = true;
};
window.onkeyup = e => keys[e.code] = false;

function drawPlayer() {
    ctx.save();
    ctx.translate(player.x + player.w / 2, player.y + player.h / 2);
    if (!player.facingRight) ctx.scale(-1, 1);
    
    // Simple character design
    ctx.fillStyle = "#ffdbac"; 
    ctx.fillRect(-15, -28, 30, 25); // Head
    ctx.fillStyle = "#334155"; 
    ctx.fillRect(-18, -3, 36, 25); // Torso
    ctx.fillStyle = "#1e293b"; 
    ctx.fillRect(-18, 22, 16, 12); // Left leg
    ctx.fillRect(2, 22, 16, 12); // Right leg
    
    // Eyes
    ctx.fillStyle = "white";
    ctx.fillRect(2, -20, 8, 8);
    ctx.fillStyle = "black";
    ctx.fillRect(6, -18, 4, 4);
    
    ctx.restore();
}

function triggerQuiz() {
    isPaused = true;
    gameActive = false;
    
    const currentQ = questionsDeck[0];
    const questionEl = document.getElementById('question-text');
    const feedbackEl = document.getElementById('feedback-area');
    const container = document.getElementById('options-container');
    
    questionEl.innerText = currentQ.q;
    feedbackEl.innerText = "";
    container.innerHTML = '';
    
    // Randomize options for this specific instance
    let opts = shuffle([...currentQ.a]); 

    opts.forEach(opt => {
        const btn = document.createElement('button');
        btn.className = 'option-btn'; 
        btn.innerText = opt;
        btn.onclick = () => {
            // Disable all buttons immediately
            Array.from(container.children).forEach(b => b.disabled = true);
            
            if (opt === currentQ.correct) {
                btn.classList.add('correct');
                feedbackEl.style.color = "#22c55e";
                feedbackEl.innerText = "CORRECT!";
                coins += 10;
                document.getElementById('stats-coins').innerText = `Score: ${coins}`;
                
                setTimeout(() => {
                    document.getElementById('quiz-overlay').style.display = 'none';
                    questionsDeck.shift(); // Remove correct answer
                    if (questionsDeck.length === 0) {
                        gameActive = false;
                        document.getElementById('message').style.display = 'block';
                        document.getElementById('message').innerText = "MASTERY!";
                    } else {
                        isPaused = false;
                        gameActive = true;
                    }
                }, 1000);
            } else {
                btn.classList.add('wrong');
                feedbackEl.style.color = "#ef4444";
                feedbackEl.innerText = `WRONG! Correct answer: ${currentQ.correct}`;
                
                // Show feedback for longer so they can read the answer
                setTimeout(() => {
                    document.getElementById('quiz-overlay').style.display = 'none';
                    isFalling = true;
                    failSound.play().catch(()=>{});
                    // Move current question to back of deck
                    questionsDeck.push(questionsDeck.shift());
                    isPaused = false;
                }, 2500);
            }
        };
        container.appendChild(btn);
    });
    
    document.getElementById('quiz-overlay').style.display = 'flex';
}

function update() {
    if (!gameStarted) { requestAnimationFrame(update); return; }

    if (timer <= 0) {
        gameActive = false;
        document.getElementById('message').style.display = 'block';
        document.getElementById('message').innerText = "TIME UP!";
    }

    if (isFalling) {
        player.vy += gravity; 
        player.y += player.vy;
        if (player.y > canvas.height + 100) {
            lives--; 
            document.getElementById('stats-lives').innerText = `Lives: ${lives}`;
            if (lives <= 0) { 
                gameActive = false; 
                document.getElementById('message').style.display = 'block'; 
                document.getElementById('message').innerText = "GAME OVER"; 
            } else { 
                player.x = Math.max(100, player.x - 400); 
                player.y = 100; 
                player.vy = 0; 
                isFalling = false; 
                if (timer > 0) gameActive = true; 
            }
        }
    } else if (gameActive && !isPaused) {
        if (keys['ArrowRight'] || keys['KeyD']) { player.vx = player.speed; player.facingRight = true; }
        else if (keys['ArrowLeft'] || keys['KeyA']) { player.vx = -player.speed; player.facingRight = false; }
        else player.vx *= 0.8;

        player.vy += gravity; 
        player.x += player.vx; 
        player.y += player.vy;

        // Ground collision
        if (player.y + player.h > 450) { 
            player.y = 450 - player.h; 
            player.vy = 0; 
            player.grounded = true; 
            player.jumpsAvailable = 2; // Reset double jump on ground
        }
        
        // Block collision
        blocks.forEach((b) => {
            if (b.active && player.x < b.x + b.w && player.x + player.w > b.x && player.y < b.y + b.h && player.y + player.h > b.y) {
                // Hitting block from below
                if (player.vy < 0 && player.y > b.y + b.h - 20) { 
                    b.active = false; 
                    player.vy = 2; 
                    if(questionsDeck.length > 0) triggerQuiz(); 
                } 
                // Landing on block
                else if (player.vy > 0 && player.y + player.h < b.y + 20) {
                    player.y = b.y - player.h;
                    player.vy = 0;
                    player.grounded = true;
                    player.jumpsAvailable = 2;
                }
            }
        });

        // Horizontal boundaries (optional)
        if (player.x < 0) player.x = 0;
    }
    
    // Rendering
    ctx.setTransform(1,0,0,1,0,0); 
    // Sky background
    const grd = ctx.createLinearGradient(0, 0, 0, canvas.height);
    grd.addColorStop(0, "#87CEEB");
    grd.addColorStop(1, "#b0e2ff");
    ctx.fillStyle = grd;
    ctx.fillRect(0,0,canvas.width,canvas.height);

    // Camera follow
    let camX = -player.x + 200; 
    if (camX > 0) camX = 0;
    ctx.translate(camX, 0);

    // Ground
    ctx.fillStyle = isFalling ? '#0f172a' : '#2dd4bf'; 
    ctx.fillRect(-1000, 450, 20000, 50);
    
    // Ground detail
    ctx.fillStyle = '#14b8a6';
    for(let i=0; i<100; i++) {
        ctx.fillRect(i*300, 450, 100, 10);
    }

    // Draw Blocks
    blocks.forEach(b => { 
        if (b.active) { 
            // Draw a more stylish block
            ctx.fillStyle = '#fbbf24'; 
            ctx.fillRect(b.x, b.y, b.w, b.h); 
            ctx.strokeStyle = '#b45309';
            ctx.lineWidth = 4;
            ctx.strokeRect(b.x+2, b.y+2, b.w-4, b.h-4);
            
            ctx.fillStyle = '#b45309'; 
            ctx.font = 'bold 30px Arial'; 
            ctx.textAlign = 'center';
            ctx.fillText('?', b.x + b.w/2, b.y + b.h/2 + 10); 
        } 
    });

    drawPlayer();
    requestAnimationFrame(update);
}

// Timer Logic
setInterval(() => { 
    if (gameActive && !isPaused && timer > 0) { 
        timer--; 
        document.getElementById('stats-timer').innerText = "Time: " + timer + "s"; 
    } 
}, 1000);

update();
</script>
</body>
</html>