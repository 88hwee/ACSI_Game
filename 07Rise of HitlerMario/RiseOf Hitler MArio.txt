<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rise of Hitler: Mastery Quest</title>
    <style>
        body { margin: 0; background: #111; font-family: 'Segoe UI', sans-serif; overflow: hidden; color: white; }
        #game-container { 
            position: relative; width: 800px; height: 400px; margin: 20px auto; 
            background: linear-gradient(to bottom, #87CEEB, #b0e2ff); 
            border: 4px solid #333; overflow: hidden; 
        }
        canvas { display: block; }
        #start-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); display: flex; flex-direction: column;
            justify-content: center; align-items: center; z-index: 200;
        }
        #btn-start {
            padding: 15px 35px; font-size: 22px; font-weight: bold; color: #111;
            background: #ffd700; border: none; border-radius: 8px; cursor: pointer; transition: 0.2s;
        }
        #btn-start:hover { transform: scale(1.1); background: #fff; }
        #ui-layer { position: absolute; top: 15px; left: 20px; right: 20px; pointer-events: none; display: flex; justify-content: space-between; font-weight: bold; text-shadow: 2px 2px #000; font-size: 18px; z-index: 10; }
        #stats-coins { color: #ffd700; }
        #quiz-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); display: none; flex-direction: column;
            justify-content: center; align-items: center; text-align: center; padding: 20px; z-index: 100;
        }
        .option-btn { background: #fff; color: #111; border: none; padding: 12px; margin: 5px; cursor: pointer; width: 85%; border-radius: 8px; font-size: 16px; font-weight: bold; }
        .option-btn:hover { background: #FFD700; }
        #message { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 60px; display: none; text-align: center; text-shadow: 4px 4px 0px #000; z-index: 110; font-weight: 900; color: #ff4d4d; width: 100%; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="start-screen">
        <h1 style="color: gold;">History Mastery Quest</h1>
        <p>Correct = Question Removed | Wrong = Falling & Retry Later</p>
        <button id="btn-start">START GAME</button>
    </div>
    <div id="ui-layer">
        <div id="stats-lives" style="color:#ff4d4d">Lives: 3</div>
        <div id="stats-coins">Coins: 0</div>
        <div id="stats-timer">120s</div>
    </div>
    <canvas id="gameCanvas" width="800" height="400"></canvas>
    <div id="quiz-overlay">
        <div id="question-text" style="color: gold; font-size: 19px; margin-bottom: 15px;"></div>
        <div id="options-container" style="width:100%"></div>
    </div>
    <div id="message"></div>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
// Integrated your specific audio file
const failSound = new Audio('mixkit-player-losing-or-failing-2042.wav');

let gameStarted = false, gameActive = false, isFalling = false;
let timer = 120, lives = 3, coins = 0, streak = 0;
const gravity = 0.45;

const player = { x: 100, y: 200, w: 40, h: 65, vx: 0, vy: 0, speed: 5, jumpPower: -11, grounded: false, facingRight: true };

// Full Question Deck (truncated for space, but uses your provided list logic)
let questionsDeck = [
    { q: "The Weimar Republic was created after:", a: ["1871 unification", "Germany’s defeat in WWI", "The Great Depression ended", "Hitler became Chancellor"], correct: "Germany’s defeat in WWI" },
    { q: "A key problem of proportional representation was that it:", a: ["Guaranteed one-party rule", "Produced many parties and unstable coalitions", "Banned extremist parties", "Removed elections"], correct: "Produced many parties and unstable coalitions" },
    { q: "The Treaty of Versailles caused anger mainly because Germans felt it was:", a: ["Too generous", "A “diktat” imposed without negotiation", "Written by Germany", "Secretly beneficial"], correct: "A “diktat” imposed without negotiation" },
    { q: "The “war guilt clause” is also known as:", a: ["Article 48", "Article 231", "Enabling Act", "Dawes Plan"], correct: "Article 231" },
    { q: "Reparations were:", a: ["Rewards Germany received", "Payments Germany had to make to the Allies", "A Nazi youth programme", "A type of election"], correct: "Payments Germany had to make to the Allies" },
    { q: "Hyperinflation in 1923 was triggered largely by:", a: ["Too much gold", "Printing money to pay debts and the Ruhr crisis", "Winning WWI", "Low unemployment"], correct: "Printing money to pay debts and the Ruhr crisis" },
    { q: "During hyperinflation, people with savings were generally:", a: ["Protected", "Ruined as money lost value", "Richer overnight", "Unaffected"], correct: "Ruined as money lost value" },
    { q: "The Ruhr crisis involved:", a: ["France/Belgium occupying an industrial region", "Germany occupying Poland", "Britain invading Berlin", "The USA closing banks"], correct: "France/Belgium occupying an industrial region" },
    { q: "Stresemann is linked to:", a: ["Ending democracy", "Stabilising the currency and improving foreign relations", "Starting the SA", "Writing Mein Kampf"], correct: "Stabilising the currency and improving foreign relations" },
    { q: "The Dawes Plan (1924) mainly:", a: ["Increased reparations sharply", "Reorganised reparations and relied on US loans", "Created the Gestapo", "Ended elections"], correct: "Reorganised reparations and relied on US loans" },
    { q: "The “Golden Years” (mid-1920s) were marked by:", a: ["Total poverty", "Relative stability and cultural growth", "Civil war", "One-party dictatorship"], correct: "Relative stability and cultural growth" },
    { q: "A major weakness of the Golden Years was that Germany:", a: ["Had no industry", "Depended heavily on US loans", "Had no elections", "Had no trade"], correct: "Depended heavily on US loans" },
    { q: "The Great Depression began after:", a: ["Wall Street Crash (1929)", "Versailles (1919)", "Ruhr occupation (1923)", "Enabling Act (1933)"], correct: "Wall Street Crash (1929)" },
    { q: "The Great Depression affected Germany strongly because:", a: ["Germany had no banks", "US loans were recalled and trade collapsed", "Germany was rich in oil", "Germany avoided world markets"], correct: "US loans were recalled and trade collapsed" },
    { q: "Rising unemployment mainly led to:", a: ["More trust in democracy", "Political extremism gaining support", "Fewer elections", "A new monarchy"], correct: "Political extremism gaining support" },
    { q: "The Nazi Party is also called:", a: ["SPD", "NSDAP", "KPD", "DNVP"], correct: "NSDAP" },
    { q: "Hitler’s book was:", a: ["Das Kapital", "Mein Kampf", "The Communist Manifesto", "The Prince"], correct: "Mein Kampf" },
    { q: "Hitler became leader of the Nazi Party in:", a: ["1914", "1921", "1929", "1939"], correct: "1921" },
    { q: "The Beer Hall Putsch (1923) was:", a: ["A successful revolution", "A failed Nazi coup attempt in Munich", "A German election", "A treaty"], correct: "A failed Nazi coup attempt in Munich" },
    { q: "After the Beer Hall Putsch, Hitler:", a: ["Was executed", "Was imprisoned and used the trial for publicity", "Fled to the USA forever", "Joined the Communists"], correct: "Was imprisoned and used the trial for publicity" },
    { q: "After 1923, Hitler changed strategy to:", a: ["Only violence", "Winning power legally through elections", "Ignoring propaganda", "Giving up politics"], correct: "Winning power legally through elections" },
    { q: "Nazi propaganda was led by:", a: ["Goebbels", "Stalin", "Churchill", "Trotsky"], correct: "Goebbels" },
    { q: "A key Nazi slogan theme was:", a: ["“Peace and disarmament”", "“Work and bread” / national revival", "“More reparations”", "“Join the League”"], correct: "“Work and bread” / national revival" },
    { q: "The SA were:", a: ["Secret police", "Nazi stormtroopers who used intimidation", "German judges", "Church leaders"], correct: "Nazi stormtroopers who used intimidation" },
    { q: "The SS originally:", a: ["Was Hitler’s personal bodyguard unit", "Was the Weimar parliament", "Was a trade union", "Controlled the USA"], correct: "Was Hitler’s personal bodyguard unit" },
    { q: "The KPD were:", a: ["Conservatives", "Communists", "Nazis", "Monarchists"], correct: "Communists" },
    { q: "Many middle-class voters feared communism because they worried about:", a: ["Losing property and social order", "Too much democracy", "Too many holidays", "Lower taxes"], correct: "Losing property and social order" },
    { q: "In 1932, the Nazis:", a: ["Never won votes", "Became the largest party in the Reichstag (but not a majority)", "Were banned", "Had no leader"], correct: "Became the largest party in the Reichstag (but not a majority)" },
    { q: "Hindenburg was:", a: ["A Nazi stormtrooper", "President of Germany", "A communist leader", "A British prime minister"], correct: "President of Germany" },
    { q: "“Backstairs intrigue” refers to:", a: ["Street fighting", "Political deals by elites behind the scenes", "Election leaflets", "Foreign invasion"], correct: "Political deals by elites behind the scenes" },
    { q: "Von Papen is best described as:", a: ["A communist organiser", "A conservative politician who helped manoeuvre Hitler into office", "A Nazi youth leader", "A French general"], correct: "A conservative politician who helped manoeuvre Hitler into office" },
    { q: "Hitler became Chancellor on:", a: ["30 Jan 1933", "1 Sep 1939", "11 Nov 1918", "28 Jun 1919"], correct: "30 Jan 1933" },
    { q: "The Reichstag Fire happened in:", a: ["1923", "1933", "1936", "1941"], correct: "1933" },
    { q: "The Reichstag Fire was used to:", a: ["Expand civil liberties", "Justify arrests and limits on freedoms", "End the army", "Raise wages"], correct: "Justify arrests and limits on freedoms" },
    { q: "The Enabling Act (March 1933) allowed Hitler to:", a: ["Rule by decree without parliament", "Leave Germany", "Abolish the presidency immediately", "Create the League of Nations"], correct: "Rule by decree without parliament" },
    { q: "“Gleichschaltung” means:", a: ["Rebuilding roads only", "Coordination: bringing institutions under Nazi control", "Paying reparations", "Army disarmament"], correct: "Coordination: bringing institutions under Nazi control" },
    { q: "The Gestapo was:", a: ["A democratic parliament", "Secret state police", "A charity", "A sports club"], correct: "Secret state police" },
    { q: "Trade unions were:", a: ["Strengthened into independent bodies", "Banned and replaced by Nazi-controlled organisations", "Put in charge of elections", "Given control of the army"], correct: "Banned and replaced by Nazi-controlled organisations" },
    { q: "The “Night of the Long Knives” (1934) was:", a: ["A peace treaty", "A purge to remove SA leaders and rivals", "A communist uprising", "The Reichstag election"], correct: "A purge to remove SA leaders and rivals" },
    { q: "After Hindenburg died (1934), Hitler:", a: ["Resigned", "Combined President + Chancellor roles as Führer", "Held a free multi-party election", "Restored the Kaiser"], correct: "Combined President + Chancellor roles as Führer" }
];

function shuffle(arr) { for (let i = arr.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [arr[i], arr[j]] = [arr[j], arr[i]]; } }
shuffle(questionsDeck);

const blocks = Array.from({length: 40}, (_, i) => ({ x: 500 + (i * 350), y: 180, w: 50, h: 50, active: true }));

document.getElementById('btn-start').onclick = () => {
    document.getElementById('start-screen').style.display = 'none';
    gameStarted = true; gameActive = true;
    failSound.play().then(() => { failSound.pause(); failSound.currentTime = 0; }).catch(() => {});
};

const keys = {};
window.onkeydown = e => keys[e.code] = true;
window.onkeyup = e => keys[e.code] = false;

function drawPlayer() {
    ctx.save();
    ctx.translate(player.x + player.w / 2, player.y + player.h / 2);
    if (!player.facingRight) ctx.scale(-1, 1);
    ctx.fillStyle = "#ffdbac"; ctx.fillRect(-15, -30, 30, 25); 
    ctx.fillStyle = "white"; ctx.fillRect(-10, -22, 8, 10); ctx.fillRect(2, -22, 8, 10); 
    ctx.fillStyle = "black"; ctx.fillRect(-7, -19, 4, 5); ctx.fillRect(5, -19, 4, 5); 
    ctx.fillStyle = "white"; ctx.fillRect(-16, -5, 32, 22); 
    ctx.fillStyle = "#0055ff"; ctx.fillRect(-16, 17, 32, 13); 
    ctx.fillStyle = "#ffdbac"; ctx.fillRect(-12, 30, 8, 5); ctx.fillRect(4, 30, 8, 5); 
    ctx.restore();
}

function triggerQuiz() {
    gameActive = false;
    const currentQ = questionsDeck[0];
    document.getElementById('question-text').innerText = currentQ.q;
    const container = document.getElementById('options-container');
    container.innerHTML = '';
    let opts = [...currentQ.a]; shuffle(opts);

    opts.forEach(opt => {
        const btn = document.createElement('button');
        btn.className = 'option-btn'; btn.innerText = opt;
        btn.onclick = () => {
            document.getElementById('quiz-overlay').style.display = 'none';
            if (opt === currentQ.correct) {
                coins += 10; streak++;
                if (streak === 10) { coins += 5; streak = 0; }
                document.getElementById('stats-coins').innerText = `Coins: ${coins}`;
                questionsDeck.shift(); 
                gameActive = (timer > 0); // Only resume if time left
            } else {
                streak = 0; isFalling = true; failSound.play(); 
                questionsDeck.push(questionsDeck.shift()); 
            }
        };
        container.appendChild(btn);
    });
    document.getElementById('quiz-overlay').style.display = 'flex';
}

function update() {
    if (!gameStarted) { requestAnimationFrame(update); return; }

    // Hard stop when timer is 0
    if (timer <= 0) {
        gameActive = false;
        document.getElementById('message').style.display = 'block';
        document.getElementById('message').innerText = "TIME UP!";
    }

    if (isFalling) {
        player.vy += gravity; player.y += player.vy;
        if (player.y > 500) {
            lives--; document.getElementById('stats-lives').innerText = `Lives: ${lives}`;
            if (lives <= 0) { 
                gameActive = false; document.getElementById('message').style.display = 'block'; 
                document.getElementById('message').innerText = "GAME OVER"; 
            } else { 
                player.x -= 300; player.y = 100; player.vy = 0; isFalling = false; 
                if (timer > 0) gameActive = true; 
            }
        }
    } else if (gameActive) {
        if (keys['ArrowRight']) { player.vx = player.speed; player.facingRight = true; }
        else if (keys['ArrowLeft']) { player.vx = -player.speed; player.facingRight = false; }
        else player.vx *= 0.8;
        if (keys['Space'] && player.grounded) { player.vy = player.jumpPower; player.grounded = false; }
        player.vy += gravity; player.x += player.vx; player.y += player.vy;
        if (player.y + player.h > 350) { player.y = 350 - player.h; player.vy = 0; player.grounded = true; }
        
        blocks.forEach((b, i) => {
            if (b.active && player.x < b.x + b.w && player.x + player.w > b.x && player.y < b.y + b.h && player.y + player.h > b.y) {
                if (player.vy < 0) { 
                    b.active = false; player.vy = 2; 
                    if(questionsDeck.length > 0) triggerQuiz(); 
                    else { gameActive = false; document.getElementById('message').style.display = 'block'; document.getElementById('message').innerText = "MASTERY!"; }
                }
            }
        });
    }
    
    // Always render so the player can see the "frozen" screen
    ctx.setTransform(1,0,0,1,0,0); ctx.clearRect(0,0,canvas.width,canvas.height);
    let camX = -player.x + 150; if (camX > 0) camX = 0;
    ctx.translate(camX, 0);
    ctx.fillStyle = isFalling ? '#111' : '#333'; ctx.fillRect(-1000, 350, 20000, 50);
    blocks.forEach(b => { if (b.active) { ctx.fillStyle = '#ffd600'; ctx.fillRect(b.x, b.y, b.w, b.h); ctx.fillStyle = 'black'; ctx.font = 'bold 20px Arial'; ctx.fillText('?', b.x+15, b.y+33); } });
    drawPlayer();
    requestAnimationFrame(update);
}

// Timer Logic
setInterval(() => { 
    if (gameActive && timer > 0) { 
        timer--; 
        document.getElementById('stats-timer').innerText = timer + "s"; 
    } 
}, 1000);

update();
</script>
</body>
</html>